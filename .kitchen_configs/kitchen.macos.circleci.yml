---
# from https://github.com/scoopex/puppet-kitchen_template
driver:
  name: vagrant
  provider: virtualbox
  provision: true

provisioner:
  name: puppet_apply
  modules_path: "modules:r10k_modules"
  hiera_data_path: data
  hiera_data_remote_path: /tmp/kitchen/data
  hiera_deep_merge: false
  provision_command: echo PROVISION
  puppet_verbose: true
  puppet_binary: /opt/puppetlabs/bin/puppet
  puppet_debug: true
  require_chef_for_busser: true
  require_puppet_collections: false
  require_puppet_omnibus: false
  require_puppet_repo: false
  resolve_with_librarian_puppet: false
  resolve_with_r10k: false
  update_package_repos: false
  custom_options: '--show_diff'
  verify_host_key: false

verifier:
  name: serverspec
  default_pattern: true
  remote_exec: false

busser:
  ruby_bindir: /usr/bin

platforms:
  - name: macos-1015
    driver:
      box: macinbox
  - name: circleci-macos
    driver:
      name: localhost
      clean_up_on_destroy: false

suites:
  - name: default
    provisioner:
      custom_options: '-e "include roles_profiles::roles::<%= ENV["PUPPET_ROLE"] %>"'
      custom_facts:
        puppet_role: <%= ENV['PUPPET_ROLE'] %>
    verifier:
      patterns:
      - test/integration/<%= ENV['PUPPET_ROLE'] %>/serverspec/*_spec.rb
      default_pattern: false
      format: progress
      extra_flags: --format RspecJunitFormatter -o rspec/rspec.xml
    includes:
      - circleci-macos
    attributes:
